<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Updation of details</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap');

  :root{
    --card-bg: rgba(12,20,62,.93);
    --overlay: rgba(10,23,55,.65);
    --text: #fff;
    --accent-1:#3ecbff;
    --accent-2:#365eff;
  }

  *{ box-sizing:border-box; }

  body{
    margin:0; padding:0; min-height:100vh;
    font-family:'Montserrat', Arial, sans-serif;
    background:url('https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=1350&q=80')
      no-repeat center/cover;
    display:flex; justify-content:center; align-items:center;
    position:relative; overflow:hidden;
    color:var(--text);
  }

  .overlay{
    position:fixed; inset:0;
    background:var(--overlay);
    z-index:0; backdrop-filter:blur(1.5px);
  }

  .form-card{
    position:relative; z-index:1;
    background:var(--card-bg);
    border-radius:20px; box-shadow:0 8px 40px #111b44cf;
    padding:28px; width:min(820px, 95vw);
    display:flex; flex-direction:column; gap:16px;
  }

  .form-card h1{
    font-size:2rem; margin:0 0 6px 0;
    letter-spacing:.5px;
    background:linear-gradient(90deg, var(--accent-1) 20%, var(--accent-2) 80%);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }

  .note{
    margin-top:-6px; color:#cfe2ff; font-size:.90rem;
  }

  fieldset{
    border:1px solid #2a3777; border-radius:12px; padding:12px 14px;
  }
  legend{ padding:0 6px; color:#e9efff; font-weight:700; }

  .radio-row{
    display:flex; flex-wrap:wrap; gap:14px 18px; margin-top:8px;
  }
  .radio-row label{ display:flex; align-items:center; gap:8px; cursor:pointer; }

  .form-fields{
    display:grid; grid-template-columns:1fr 1fr; gap:10px 10px; margin-top:2px;
  }
  .full-width{ grid-column:1 / -1; }

  label { font-size:.88rem; font-weight:600; color:#e9efff; }

  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="number"],
  input[type="password"]{
    width:100%; padding:10px 12px; border-radius:10px; border:none;
    background:rgba(255,255,255,.08); color:#eef4ff;
    font-size:1rem; outline:none; transition:background .16s, box-shadow .16s;
    box-shadow:inset 0 2px 7px #141a3b15;
  }
  input:focus{
    background:rgba(64,160,255,.17); box-shadow:0 0 0 2px #27c7fb99;
  }

  .actions{ display:flex; justify-content:flex-end; margin-top:6px; }
  .btn{
    background:linear-gradient(90deg,#26fefc 20%,#2196f3 90%);
    color:#222; font-weight:700; padding:12px 28px;
    border-radius:10px; font-size:1.05rem; border:none; cursor:pointer;
    box-shadow:0 2px 12px #24adee74;
  }
  .btn:hover, .btn:focus{
    background:linear-gradient(90deg,#1fe6f4 10%,#365eff 90%); color:#fff;
    box-shadow:0 4px 18px #1fe5f86b;
  }

  .links{ font-size:1rem; text-align:center; color:#e9efff; }
  .links a{ color:#26fefc; text-decoration:underline; font-weight:600; }

  .message{ margin-top:10px; padding:12px; border-radius:8px; font-weight:600; text-align:center; }
  .success{ background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
  .error{ background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }

  @media (max-width:600px){
    .form-fields{ grid-template-columns:1fr; }
  }
</style>
</head>

<body>
  <div class="overlay" aria-hidden="true"></div>
  <div class="form-card" role="form" aria-labelledby="title">
    <h1 id="title">Update Your Details</h1>
    <p class="note">Note: Except ID, everything can be changed. Contact your administrator for ID change. Also, Current field and New field can't be same</p>
    <!-- Use POST so passwords never go into the URL -->
    <form action="${pageContext.request.contextPath}/update" method="post" autocomplete="on" onsubmit="return validate();">
      <p><%
      if(session != null) {
          out.println("ID: " + session.getAttribute("id"));
      } else {
          out.println("No session available");
      } %>

</p>
      <fieldset>
        <legend>Select field to update</legend>
        <div class="radio-row" role="radiogroup" aria-label="Field to update">
          <label><input type="radio" name="loginType" value="first_name" checked /> First Name</label>
          <label><input type="radio" name="loginType" value="last_name" /> Last Name</label>
          <label><input type="radio" name="loginType" value="phone_number" /> Phone Number</label>
          <label><input type="radio" name="loginType" value="age" /> Age</label>
          <label><input type="radio" name="loginType" value="email" /> Email</label>
        </div>
      </fieldset>
	  <div class="form-fields">
	  <div class="full-width">
	  <p id="prev">Previous First Name:</p>
	  </div>
	  </div>	 
      <div class="form-fields">
        <div class="full-width">
          <label id="loginLabel" for="loginValue">New First Name:</label>
          <input
            id="loginValue"
            name="loginValue"
            type="text"
            required
            autocomplete="section-update given-name"
            inputmode="text"
          />
        </div>

        <div class="full-width">
          <label for="password">Password:</label>
          <input
            id="password"
            name="password"
            type="password"
            required
            minlength="8"
            autocomplete="current-password"
          />
        </div>
      </div>

      <div class="actions">
		<button type="submit" class="btn" onclick=validate()>Submit</button>
      </div>

      <div class="links" aria-live="polite">
        <p>Want to go back to Login? <a href="login.jsp">Click here</a></p>
        <p>Want to go back to Registration? <a href="register.jsp">Click here</a></p>
      </div>
    </form>
  </div>

<script>
 /*  const first_name = "<%= session.getAttribute("first_name") != null ? session.getAttribute("first_name") : "" %>";
  const last_name = "<%= session.getAttribute("last_name") != null ? session.getAttribute("last_name") : "" %>";
  const age = "<%= session.getAttribute("age") != null ? session.getAttribute("age") : "" %>";
  const phone = "<%= session.getAttribute("phone") != null ? session.getAttribute("phone") : "" %>";
  const email = "<%= session.getAttribute("email") != null ? session.getAttribute("email") : "" %>";
  */ const radios = document.querySelectorAll('input[name="loginType"]');
  const loginLabel = document.getElementById('loginLabel');
  const loginValueInput = document.getElementById('loginValue');
  const prevfield = document.getElementById('prev');
  const params = Object.fromEntries(new URLSearchParams(location.search));

  function toTitleCaseKey(key){
    return key.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
  }

  function configureInputFor(type){
    loginValueInput.removeAttribute('min');
    loginValueInput.removeAttribute('max');
    loginValueInput.removeAttribute('pattern');

    if (type === 'age'){
      loginValueInput.type = 'number';
      loginValueInput.min = '1';
      loginValueInput.max = '120';
      loginValueInput.inputMode = 'numeric';
      loginValueInput.autocomplete = 'off';
    } else if (type === 'email'){
      loginValueInput.type = 'email';
      loginValueInput.inputMode = 'email';
      loginValueInput.autocomplete = 'section-update email';
    } else if (type === 'phone_number'){
      loginValueInput.type = 'tel';
      loginValueInput.inputMode = 'tel';
      loginValueInput.pattern = '[0-9]{10}';
      loginValueInput.autocomplete = 'section-update tel';
    } else {
      loginValueInput.type = 'text';
      loginValueInput.inputMode = 'text';
      if (type === 'first_name'){
        loginValueInput.autocomplete = 'section-update given-name';
      } else if (type === 'last_name'){
        loginValueInput.autocomplete = 'section-update family-name';
      } else {
        loginValueInput.autocomplete = 'section-update';
      }
    }
  }

  function updatePreviousField(){
    const selected = document.querySelector('input[name="loginType"]:checked').value;
    if(selected === "first_name"){
      prevfield.innerHTML = "Your Current First Name: " + first_name;
    } else if(selected === "last_name"){
      prevfield.innerHTML = "Your Current Last Name: " + last_name;
    } else if(selected === "age"){
      prevfield.innerHTML = "Your Current Age: " + age;
    } else if(selected === "phone_number"){
      prevfield.innerHTML = "Your Current Phone Number: " + phone;
    } else if(selected === "email"){
      prevfield.innerHTML = "Your Current Email Address: " + email;
    }
  }
  function validate() {
	  const selected = document.querySelector('input[name="loginType"]:checked').value;
	  const newValue = loginValueInput.value.trim();
	  let currentValue = "";
	  if (selected === "first_name") {
	    currentValue = first_name.trim();
	  } else if (selected === "last_name") {
	    currentValue = last_name.trim();
	  } else if (selected === "age") {
	    currentValue = age.trim();
	  } else if (selected === "phone_number") {
	    currentValue = phone.trim();
	  } else if (selected === "email") {
	    currentValue = email.trim();
	  }
	  if (newValue === "") {
	    alert("Please enter a value to update.");
	    loginValueInput.focus();
	    return false; 
	  }
	  if (newValue === currentValue) {
	    alert("The new value cannot be the same as the current value.");
	    loginValueInput.focus();
	    return false; 
	  }
	  return true;
	}

  function updateLoginField(){
    const selected = document.querySelector('input[name="loginType"]:checked').value;
    loginLabel.textContent = toTitleCaseKey(selected) + ':';
    configureInputFor(selected);
    loginValueInput.value = params[selected] || '';
    loginValueInput.focus();
    updatePreviousField();  // update displayed previous value
  }

  radios.forEach(r => r.addEventListener('change', updateLoginField));
  window.addEventListener('DOMContentLoaded', updateLoginField);
</script>
</body>
</html>